generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(cuid())
  name          String
  email         String   @unique
  password      String
  role          String   @default("makelaar") // manager, makelaar, binnendienst
  active        Boolean  @default(true)
  assignedTasks Task[]   @relation("assignee")
  createdTasks  Task[]   @relation("creator")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("users")
}

model Project {
  id              String   @id @default(cuid())
  name            String
  description     String?  @db.Text
  status          String   @default("lead") // lead, actief, afgerond, geannuleerd
  address         String?
  notionPageId    String?  @unique
  mauticContactId Int?
  contactName     String?
  contactPhone    String?
  contactEmail    String?
  tasks           Task[]
  calls           Call[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([status])
  @@index([notionPageId])
  @@index([mauticContactId])
  @@map("projects")
}

model Call {
  id                String   @id @default(cuid())
  callId            String   @unique
  timestamp         DateTime
  status            String   // ringing, in-progress, ended
  reason            String?  // completed, no-answer, busy, cancelled
  direction         String   // inbound, outbound
  callerNumber      String
  callerName        String?
  destinationNumber String
  destinationUser   String?
  mauticContactId   Int?
  contactName       String?
  points            Int      @default(0)
  project           Project? @relation(fields: [projectId], references: [id])
  projectId         String?
  notes             CallNote[]
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([timestamp])
  @@index([callerNumber])
  @@index([mauticContactId])
  @@index([projectId])
  @@map("calls")
}

model CallNote {
  id        String   @id @default(cuid())
  call      Call     @relation(fields: [callId], references: [id])
  callId    String
  note      String   @db.Text
  createdBy String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([callId])
  @@map("call_notes")
}

model Task {
  id               String      @id @default(cuid())
  title            String
  description      String?     @db.Text
  status           String      @default("open") // open, bezig, afgerond
  priority         String      @default("normaal") // laag, normaal, hoog, urgent
  dueDate          DateTime?
  category         String?     // binnendienst, verkoop, aankoop, taxatie, administratie
  assignee         User        @relation("assignee", fields: [assigneeId], references: [id])
  assigneeId       String
  creator          User        @relation("creator", fields: [creatorId], references: [id])
  creatorId        String
  project          Project?    @relation(fields: [projectId], references: [id])
  projectId        String?
  notionPageId     String?
  completedAt      DateTime?
  // Tijdregistratie
  timerStartedAt   DateTime?   // null = timer gestopt, gevuld = timer loopt
  totalTimeSpent   Int         @default(0) // opgetelde seconden van afgesloten sessies
  timeEntries      TimeEntry[]
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt

  @@index([assigneeId])
  @@index([status])
  @@index([dueDate])
  @@index([projectId])
  @@map("tasks")
}

model TimeEntry {
  id        String    @id @default(cuid())
  task      Task      @relation(fields: [taskId], references: [id], onDelete: Cascade)
  taskId    String
  startedAt DateTime
  stoppedAt DateTime?  // null = sessie nog actief
  duration  Int       @default(0) // seconden, ingevuld bij stoppen
  createdAt DateTime  @default(now())

  @@index([taskId])
  @@map("time_entries")
}
